!function(){"use strict";function i(i,e,n,t,r,o,I,l,E,O,N){function s(i){if(!Utilities.isUndefinedOrNull(i))switch(i){case t.FILE.ERROR.FILE_SIZE_MAX_EXCEEDED:o.show(t.NOTIFICATION.FILE_MAX_SIZE_BYTE_LIMIT_REACHED);break;case t.FILE.ERROR.UNSUPPORTED_FILE_TYPE:o.show(t.NOTIFICATION.UNSUPPORTEDFILETYPE);break;default:n.error(String.format("fileService.loadFile - {0}",i)),o.show(t.NOTIFICATION.FILE_UPLOAD_FAILURE_GENERIC)}}function a(i,e){Utilities.isUndefinedOrNull(e)||Utilities.isUndefinedOrNull(i)||(415===e?o.show(t.NOTIFICATION.FILE_UPLOAD_FAILURE_UNSUPPORTED_MEDIA):502===e||503===e||509===e?o.show(t.NOTIFICATION.FILE_UPLOAD_FAILURE_SERVER):(n.error(String.format("fileService.doUpload - {0} - {1}",e,JSON.stringify(i))),o.show(t.NOTIFICATION.FILE_UPLOAD_FAILURE_GENERIC)))}function T(i){var e=null;switch(i){case t.USER_TYPE.O365:e=O;break;case t.USER_TYPE.MSA:e=N;break;default:o.show(t.NOTIFICATION.NOTSIGNEDIN),n.trackEvent("FileUserTypeError_UserNotSignedIn")}return e}function U(i,e){var r;E.getUserType().then(function(I){return u=I,r=T(I),Utilities.isUndefinedOrNull(r)?void e(null):(n.trackEvent("FileServiceProviderUploadDocType_"+Utilities.getFileExtension(i.name)),o.show(t.NOTIFICATION.FILE_UPLOAD_IN_PROGRESS),void r.doUpload(i,function(i,n,t){Utilities.isUndefinedOrNull(i)&&a(n,t),e(i)}))})}function f(i,e,r){return Utilities.isUndefinedOrNull(i)||e!==t.FILE.ORIGIN.HTML5&&e!==t.FILE.ORIGIN.LOCAL_PATH?(n.error(String.format("fileService.upload(): Invalid argument: fileInfo: {0}, fileOrigin: {1}",JSON.stringify(i),e)),void r(null)):void l.loadFile(i,e).then(function(i){U(i,function(i){return Utilities.isUndefinedOrNull(i)?void r(null):void I.get("displayAutoSaveNotification").then(function(e){if(Utilities.isUndefinedOrNull(e.displayAutoSaveNotification)||e.displayAutoSaveNotification===!0){var n=t.NOTIFICATION.AUTOSAVE;n.message=u===t.USER_TYPE.MSA?t.NOTIFICATION.AUTOSAVETOONEDRIVE:t.NOTIFICATION.AUTOSAVETOSHAREPOINT,o.show(n)}r(i)})})},function(i){s(i),r(null)})}var u=t.USER_TYPE.NONE,d={upload:f};return d}angular.module("app.file",[]).factory("fileService",["$http","$q","$log","constants","localize","notification","storage","fileLoader","userService","sharePointFileService","oneDriveFileService",i])}();