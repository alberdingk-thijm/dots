!function(){"use strict";function e(e,n,i,r,o){function t(e){var n=(new Date).toISOString(),i=/(\d+)-(\d+)-(\d+)T(\d+):(\d+):(\d+).+/,r=n.replace(i,"_$1$2$3_$4$5$6.");return e.replace(".",r)}this.doUpload=function(l,d){l.name=t(l.name),o.getUserInfo(i.USER_TYPE.O365,function(o){if(Utilities.isUndefinedOrNull(o)||Utilities.isUndefinedOrNull(o.serviceInfo))return n.error("sharePointFileService.doUpload - Invalid serviceInfo"),void d(null);var t=o.serviceInfo,a=t.url+"/drive/root:/"+encodeURIComponent(r.getLocalizedString("AppFolderName"))+"/"+l.name+":/content",s={method:"PUT",url:a,headers:{"Content-Type":"application/octet-stream","X-UserType":i.USER_TYPE.O365,"X-Resource":t.resource},data:l.content,transformRequest:[]};e(s).success(function(e,i){var r="",o="";return Utilities.isUndefinedOrNull(e.eTag)?(n.error("sharePointFileService.doUpload - Missing eTag"),void d(null,e,i)):(r=e.eTag.substring(1,e.eTag.indexOf(",")),Utilities.isUndefinedOrNull(e["@content.downloadUrl"])?(n.error("sharePointFileService.doUpload - Missing downloadUrl"),void d(null,e,i)):(o=e["@content.downloadUrl"].replace(/download.aspx?.+/,"WopiFrame.aspx?sourcedoc="+r),n.debug(String.format("sharePointFileService.doUpload - {0} - {1}",i,o)),void d(o)))}).error(function(e,n){d(null,e,n)})})}}angular.module("app.file").service("sharePointFileService",["$http","$log","constants","localize","userService",e])}();